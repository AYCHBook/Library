<% title "Activity for #{@project} on #{@project.platform_name} - Libraries.io" %>
<% description "Dependency activity accross #{number_to_human(@total)} open source repositories that depend on #{@project} on #{@project.platform_name}" %>
<% content_for :meta, render_meta(@project) %>

<h1>
  <%= fa_icon 'line-chart' %>
  Activity for <%= link_to @project, project_path(@project.to_param) %>
  on <%= link_to platform_name(@project.platform), platform_path(@project.platform) %>
</h1>

<p>
  Dependency activity across <strong><%= number_to_human(@total) %></strong> open source repositories
</p>
<% if @chart_data.any? %>

  <%= line_chart @chart_data %>

  <hr>
  <div class="row">
    <div class="col-sm-8">
      <h4>
        Recent depenednecy activity for <%= link_to @project, project_path(@project.to_param) %>
        <% if params[:requirements].present? %>
          <code><%= params[:requirements] %></code>
        <% end %>
      </h4>

      <%= render @activities, cache: true %>
      <%= will_paginate @activities, page_links: false %>
    </div>
    <div class="col-sm-4">
      <h4>
        <%= fa_icon 'link' %>
        Filter by Action
      </h4>
      <ul class='filter'>
        <% @types.sort_by{|k,v| -v}.each do |type, count| %>
          <% next unless type.present? %>
          <% active = type == params[:type] %>
          <li class='<%= 'active' if active %>'>
            <% if active %>
              <%= link_to type, project_activity_path(params.permit(:requirements).merge(type: nil, page: nil)) %>
            <% else %>
              <%= link_to type, project_activity_path(params.permit(:requirements).merge(type: type, page: nil)) %>
              <small><%= number_to_human(count) %></small>
            <% end %>
          </li>
        <% end %>
      </ul>
      <h4>
        <%= fa_icon 'arrows-h' %>
        Filter by required version range
      </h4>
      <ul class='filter'>
        <% sort_by_semver_range(60).each do |requirements,count| %>
          <% next unless requirements.present? %>
          <% active = requirements == params[:requirements] %>
          <li class='<%= 'active' if active %>'>
            <% if active %>
              <%= link_to requirements, project_activity_path(params.permit(:type).merge(requirements: nil, page: nil)) %>
            <% else %>
              <%= link_to requirements, project_activity_path(params.permit(:type).merge(requirements: requirements)) %>
              <small><%= number_to_human(count) %></small>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
<% else %>
  No dependent repositories found.
<% end %>
