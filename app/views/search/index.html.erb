<% title @title %>
<% content_for :atom, auto_discovery_link_tag(:atom, url_for({format: "atom"}.merge(params))) %>
<div class="row">
  <div class='col-md-8'>
    <%= form_tag search_path, method: :get, class: 'search-form', enforce_utf8: false do |f| %>

      <div class="input-group input-group-lg">
        <%= text_field_tag 'q', '', placeholder: 'Search..', class: 'form-control', size: 40 %>
        <span class="input-group-btn">
          <button class="btn btn-primary btn-large " type="submit">Search</button>
        </span>
      </div>

      <% [:platforms, :licenses, :languages, :keywords].each do |field| %>
        <%= hidden_field_tag field, params[field] if params[field].present? %>
      <% end %>
    <% end %>
    <% if @suggestion && @suggestion.options.any? %>
      <p>
        Did you mean
        <strong><%= link_to "#{@suggestion.options.first.text}?", search_path(q: @suggestion.options.first.text) %></strong>
      </p>
    <% end %>
  </div>
  <div class='col-md-4'>
    <h3>
      <small>
        <%= page_entries_info @search, model: 'projects' %>
      </small>
    </h3>
  </div>
</div>
<div class='row'>
  <div class='col-md-8'>
    <% if @projects.any? %>
      <%= render @projects %>
      <%= will_paginate @search, renderer: BootstrapPagination::Rails, page_links: false %>
      <p>
        <%= link_to url_for(params.merge(format: :atom, sort: 'created_at', order: 'desc')) do %>
          <%= fa_icon "rss-square" %>
          Subscribe to an RSS feed of this search
        <% end %>
      </p>
    <% else %>
      <p>
        No projects found.
      </p>
      <p>
        <% if params[:platforms].present? || params[:licenses].present? ||  params[:languages].present? ||  params[:keywords].present? %>
          <%= link_to 'Try removing some filters.', search_path(q: params[:q]) %>
        <% end %>
      </p>
    <% end %>
  </div>

  <div class='col-md-4 facets'>
    <% @search.response.facets.each do |name, facet| %>
      <% next if facet['terms'].empty? %>
      <h4><%= name.humanize %></h4>
      <ul>
        <% facet['terms'].each do |term| %>
          <% active = term['term'] == params[name.to_sym] %>
          <li class='<%= 'active' if active %>'>
            <% if active %>
              <%= link_to platform_name(term['term']), url_for(params.merge(name.to_sym => nil)) %>
            <% else %>
              <%= link_to platform_name(term['term']), url_for(params.merge(name.to_sym => term['term'])) %>
              <small><%= number_to_human term['count'] %></small>
            <% end %>
          </li>
        <% end %>
        <% if params[name.to_sym].present? && !facet['terms'].map{|t| t['term']}.include?(params[name.to_sym]) %>
          <li class='active'>
            <%= link_to platform_name(params[name.to_sym]), url_for(params.merge(name.to_sym => nil)) %>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
</div>
